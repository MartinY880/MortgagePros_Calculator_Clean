<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MortgagePros™ Calculator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container-fluid p-3 main-container">
    <div class="row align-items-center mb-2">
      <div class="col-md-3 col-6">
        <img id="logo" alt="MortgagePros Logo" class="logo" style="max-height: 120px; width: auto; padding: 0; margin-top: 0; margin-bottom: 0;" />
      </div>
      <div class="col-md-7 text-center" style="padding-top: 0; padding-bottom: 0;">
        <h1 class="title-text mb-0" style="margin-bottom: 0 !important;">MortgagePros Calculator</h1>
        <p class="subtitle-text mb-0" style="margin-top: 8px !important; margin-bottom: 0 !important;">Professional • Accurate • Fast</p>
      </div>
      <div class="col-md-2 text-end d-flex flex-column align-items-end gap-2">
        <button type="button" id="themeToggle" class="theme-toggle" title="Switch to Dark Mode" aria-label="Toggle theme">
          <span class="icon">🌙</span>
          <span class="theme-text">Dark</span>
        </button>
        <div id="versionBadge" class="badge bg-gradient text-white px-2 py-1" style="background: linear-gradient(135deg, #1e40af, #3b82f6); font-size: 0.7rem;" title="Click for version details">
          v12.6.0
        </div>
      </div>
    </div>

    <!-- Custom Notification Area -->
    <div id="notificationArea" class="row mb-3" style="display: none;">
      <div class="col-12">
        <div id="notificationMessage" class="alert alert-dismissible fade show" role="alert">
          <span id="notificationText"></span>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      </div>
    </div>

    <!-- Main Content Layout - Two Columns -->
    <div class="row" style="margin-top: 0;">
      <!-- Calculator Column -->
      <div class="col-lg-8">
        <!-- Calculator Input Section with Tabs - No Top Margin -->
        <section class="calculator-section mb-2 fade-in-up" style="margin-top: 0;">
          <div class="card">
            <div class="card-header text-white">
              <div class="d-flex justify-content-between align-items-center">
                <h6 class="mb-0" style="font-size: 0.9rem;">Mortgage Calculator</h6>
                <div class="d-flex gap-1 align-items-center">
                  <select id="historySelect" class="form-select form-select-sm bg-white bg-opacity-75" style="width: auto; min-width: 160px; border-radius: 4px; font-size: 0.75rem; padding: 4px 8px;">
                    <option value="">Load Previous Calculation</option>
                  </select>
                  <button type="button" id="clearHistoryBtn" class="btn btn-outline-light btn-sm" style="border-radius: 4px; font-size: 0.75rem; padding: 4px 8px;">Clear</button>
                </div>
              </div>
          <!-- Calculator Type Tabs -->
          <ul class="nav nav-tabs mt-2" id="calculatorTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="refinance-tab" data-bs-toggle="tab" data-bs-target="#refinance" type="button" role="tab">Refinance</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="comparison-tab" data-bs-toggle="tab" data-bs-target="#comparison" type="button" role="tab">Compare Loans</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="blended-tab" data-bs-toggle="tab" data-bs-target="#blended" type="button" role="tab">Blended Mortgage</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="purchase-tab" data-bs-toggle="tab" data-bs-target="#purchase" type="button" role="tab">Purchase</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="heloc-tab" data-bs-toggle="tab" data-bs-target="#heloc" type="button" role="tab">HELOC</button>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div class="tab-content" id="calculatorTabContent">
            
            <!-- Refinance Tab (Primary) -->
            <div class="tab-pane fade show active" id="refinance" role="tabpanel">
              <form id="refinanceForm">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="appraisedValue">Appraised Value ($):</label>
                      <input type="text" inputmode="numeric" id="appraisedValue" class="form-control" value="0">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="refinanceLoanAmount">Loan Amount ($):<span class="required">*</span></label>
                      <input type="text" inputmode="numeric" id="refinanceLoanAmount" class="form-control" value="0">
                    </div>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="refinanceInterestRate">Interest Rate (%):<span class="required">*</span></label>
                      <input type="text" inputmode="decimal" id="refinanceInterestRate" class="form-control" value="0">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="refinanceLoanTerm">Loan Term (Years):<span class="required">*</span></label>
                      <input type="text" inputmode="numeric" id="refinanceLoanTerm" class="form-control" value="0">
                    </div>
                  </div>
                </div>

                <!-- Advanced Options Accordion -->
                <div class="row mb-3">
                  <div class="col-12">
                    <div class="accordion" id="refinanceAdvancedAccordion">
                      <div class="accordion-item">
                        <h2 class="accordion-header" id="headingRefiAdvanced">
                          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRefiAdvanced" aria-expanded="false" aria-controls="collapseRefiAdvanced">
                            Advanced Options (Extra Payment,HOI, PMI, Taxes, Closing Costs, etc...)
                          </button>
                        </h2>
                        <div id="collapseRefiAdvanced" class="accordion-collapse collapse" aria-labelledby="headingRefiAdvanced" data-bs-parent="#refinanceAdvancedAccordion">
                          <div class="accordion-body">
                            <div class="row">
                              <div class="col-md-6">
                                <div class="form-group">
                                  <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label for="refinancePmiAmount" id="refinancePmiLabel">PMI Monthly Amount ($):</label>
                                    <div class="form-check form-switch">
                                      <input class="form-check-input" type="checkbox" id="refinancePmiToggle">
                                      <label class="form-check-label" for="refinancePmiToggle" id="refinancePmiToggleLabel">
                                        Monthly
                                      </label>
                                    </div>
                                  </div>
                                  <input type="text" inputmode="decimal" id="refinancePmiAmount" class="form-control" value="0" placeholder="e.g., 125">
                                </div>
                                <div class="form-group mt-2">
                                  <label for="refinancePmiEndRule">PMI Ends at:</label>
                                  <select id="refinancePmiEndRule" class="form-select">
                                    <option value="80" selected>80% LTV</option>
                                    <option value="78">78% LTV</option>
                                  </select>
                                </div>
                              </div>
                              <div class="col-md-6">
                                <div class="form-group">
                                  <label for="refinancePropertyTax">Property Tax (Monthly $):</label>
                                  <input type="text" inputmode="numeric" id="refinancePropertyTax" class="form-control" value="0">
                                </div>
                                <div class="form-group mt-2">
                                  <label for="refinanceCashOut">Cash-Out Amount ($):</label>
                                  <input type="text" inputmode="decimal" id="refinanceCashOut" class="form-control" value="0" placeholder="e.g., 10000">
                                  <small class="text-muted">Optional: additional cash taken out, added to loan principal.</small>
                                </div>
                              </div>
                            </div>

                            <div class="row mt-3">
                              <div class="col-md-6">
                                <div class="form-group">
                                  <label for="refinanceHomeInsurance">Home Insurance (Monthly $):</label>
                                  <input type="text" inputmode="numeric" id="refinanceHomeInsurance" class="form-control" value="0">
                                </div>
                              </div>
                              <div class="col-md-6">
                                <div class="form-group">
                                  <label for="refinanceExtraPayment">Extra Monthly Payment ($):</label>
                                  <input type="text" inputmode="numeric" id="refinanceExtraPayment" class="form-control" value="0">
                                </div>
                              </div>
                            </div>

                            <!-- Closing Costs & Points -->
                            <div class="row mt-3">
                              <div class="col-md-6">
                                <div class="form-group">
                                  <label for="refinanceClosingCosts">Closing Costs ($):</label>
                                  <input type="text" inputmode="decimal" id="refinanceClosingCosts" class="form-control" value="0" placeholder="e.g., 3500">
                                </div>
                              </div>
                              <div class="col-md-6">
                                <div class="form-group">
                                  <label for="refinancePoints">Points (% of loan amount):</label>
                                  <input type="text" inputmode="decimal" id="refinancePoints" class="form-control" value="0" placeholder="e.g., 1">
                                </div>
                              </div>
                            </div>

                            <div class="row mt-3">
                              <div class="col-md-8">
                                <label class="form-label d-block mb-2">Closing Costs Handling</label>
                                <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="radio" name="refinanceCostHandling" id="refiCosts_due" value="due" checked>
                                  <label class="form-check-label" for="refiCosts_due">Due at Closing</label>
                                </div>
                                <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="radio" name="refinanceCostHandling" id="refiCosts_finance" value="finance">
                                  <label class="form-check-label" for="refiCosts_finance">Include in Loan Amount</label>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-12 d-flex justify-content-start">
                    <button type="button" id="calculateRefinanceBtn" class="btn btn-primary me-2">Calculate Refinance</button>
                    <button type="button" id="exportRefinanceReportBtn" class="btn btn-success">Export Report</button>
                  </div>
                </div>
              </form>
            </div>

            <!-- Comparison Tab -->
            <div class="tab-pane fade" id="comparison" role="tabpanel">
              <form id="comparisonForm">
                <div class="row mb-4">
                  <div class="col-12">
                    <div class="alert alert-info">
                      <strong>📊 Loan Comparison Tool</strong><br>
                      Compare up to 3 different loan scenarios side-by-side to find the best option for your needs.
                    </div>
                  </div>
                </div>

                <!-- Loan Comparison Cards -->
                <div class="row" id="comparisonRow">
                  <!-- Current Loan -->
                  <div class="col-lg-6 comparison-column" id="loanA_column">
                    <div class="card comparison-loan-card">
                      <div class="card-header bg-primary text-white">
                        <h6 class="mb-0">🏠 Current Loan</h6>
                      </div>
                      <div class="card-body">
                        <div class="form-group mb-3">
                          <label for="loanA_name">Loan Name:</label>
                          <input type="text" id="loanA_name" class="form-control" placeholder="e.g., Current Loan" value="Current Loan">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanA_appraisedValue">Appraised Value ($):</label>
                          <input type="text" inputmode="numeric" id="loanA_appraisedValue" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanA_amount">Loan Amount ($):<span class="required">*</span></label>
                          <input type="text" inputmode="numeric" id="loanA_amount" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanA_rate">Interest Rate (%):<span class="required">*</span></label>
                          <input type="text" inputmode="decimal" id="loanA_rate" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanA_term">Loan Term (Years):<span class="required">*</span></label>
                          <input type="text" inputmode="numeric" id="loanA_term" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="loanA_pmi" id="loanA_pmiLabel">PMI Monthly Amount ($):</label>
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" id="loanA_pmiToggle">
                              <label class="form-check-label" for="loanA_pmiToggle" id="loanA_pmiToggleLabel">
                                Monthly
                              </label>
                            </div>
                          </div>
                          <input type="text" inputmode="decimal" id="loanA_pmi" class="form-control" value="0" placeholder="e.g., 125">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanA_propertyTax">Property Tax (Monthly $):</label>
                          <input type="text" inputmode="numeric" id="loanA_propertyTax" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanA_homeInsurance">Home Insurance (Monthly $):</label>
                          <input type="text" inputmode="numeric" id="loanA_homeInsurance" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanA_extra">Extra Monthly Payment ($):</label>
                          <input type="text" inputmode="numeric" id="loanA_extra" class="form-control" value="0">
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Loan Option A -->
                  <div class="col-lg-6 comparison-column" id="loanB_column">
                    <div class="card comparison-loan-card">
                      <div class="card-header bg-success text-white">
                        <h6 class="mb-0">📋 Loan Option A</h6>
                      </div>
                      <div class="card-body">
                        <div class="form-group mb-3">
                          <label for="loanB_name">Loan Name:</label>
                          <input type="text" id="loanB_name" class="form-control" placeholder="e.g., New Loan Option" value="Option A">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanB_appraisedValue">Appraised Value ($):</label>
                          <input type="text" inputmode="numeric" id="loanB_appraisedValue" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanB_amount">Loan Amount ($):<span class="required">*</span></label>
                          <input type="text" inputmode="numeric" id="loanB_amount" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanB_rate">Interest Rate (%):<span class="required">*</span></label>
                          <input type="text" inputmode="decimal" id="loanB_rate" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanB_term">Loan Term (Years):<span class="required">*</span></label>
                          <input type="text" inputmode="numeric" id="loanB_term" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="loanB_pmi" id="loanB_pmiLabel">PMI Monthly Amount ($):</label>
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" id="loanB_pmiToggle">
                              <label class="form-check-label" for="loanB_pmiToggle" id="loanB_pmiToggleLabel">
                                Monthly
                              </label>
                            </div>
                          </div>
                          <input type="text" inputmode="decimal" id="loanB_pmi" class="form-control" value="0" placeholder="e.g., 125">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanB_propertyTax">Property Tax (Monthly $):</label>
                          <input type="text" inputmode="numeric" id="loanB_propertyTax" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanB_homeInsurance">Home Insurance (Monthly $):</label>
                          <input type="text" inputmode="numeric" id="loanB_homeInsurance" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanB_extra">Extra Monthly Payment ($):</label>
                          <input type="text" inputmode="numeric" id="loanB_extra" class="form-control" value="0">
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Loan Option B -->
                  <div class="col-lg-4 comparison-column d-none" id="loanC_column">
                    <div class="card comparison-loan-card">
                      <div class="card-header bg-warning text-white">
                        <h6 class="mb-0">📋 Loan Option B</h6>
                      </div>
                      <div class="card-body">
                        <div class="form-group mb-3">
                          <label for="loanC_name">Loan Name:</label>
                          <input type="text" id="loanC_name" class="form-control" placeholder="e.g., Alternative Option" value="Option B">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanC_appraisedValue">Appraised Value ($):</label>
                          <input type="text" inputmode="numeric" id="loanC_appraisedValue" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanC_amount">Loan Amount ($):<span class="required">*</span></label>
                          <input type="text" inputmode="numeric" id="loanC_amount" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanC_rate">Interest Rate (%):<span class="required">*</span></label>
                          <input type="text" inputmode="decimal" id="loanC_rate" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanC_term">Loan Term (Years):<span class="required">*</span></label>
                          <input type="text" inputmode="numeric" id="loanC_term" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="loanC_pmi" id="loanC_pmiLabel">PMI Monthly Amount ($):</label>
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" id="loanC_pmiToggle">
                              <label class="form-check-label" for="loanC_pmiToggle" id="loanC_pmiToggleLabel">
                                Monthly
                              </label>
                            </div>
                          </div>
                          <input type="text" inputmode="decimal" id="loanC_pmi" class="form-control" value="0" placeholder="e.g., 125">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanC_propertyTax">Property Tax (Monthly $):</label>
                          <input type="text" inputmode="numeric" id="loanC_propertyTax" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanC_homeInsurance">Home Insurance (Monthly $):</label>
                          <input type="text" inputmode="numeric" id="loanC_homeInsurance" class="form-control" value="0">
                        </div>
                        <div class="form-group mb-3">
                          <label for="loanC_extra">Extra Monthly Payment ($):</label>
                          <input type="text" inputmode="numeric" id="loanC_extra" class="form-control" value="0">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Add Option B Button -->
                <div class="row mb-3 mt-3">
                  <div class="col-12 d-flex justify-content-center">
                    <button type="button" id="addOption2Btn" class="btn btn-outline-primary">➕ Add Option B</button>
                    <button type="button" id="removeOption2Btn" class="btn btn-outline-danger d-none ms-2">✖️ Remove Option B</button>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="row mb-3 mt-4">
                  <div class="col-12 d-flex justify-content-center gap-3">
                    <button type="button" id="compareLoansBtn" class="btn btn-primary btn-lg">🔍 Compare Loans</button>
                    <button type="button" id="exportComparisonReportBtn" class="btn btn-success">📄 Export Comparison</button>
                    <button type="button" id="clearComparisonBtn" class="btn btn-outline-secondary">🔄 Clear All</button>
                  </div>
                </div>
              </form>
            </div>

            <!-- Blended Mortgage Tab -->
            <div class="tab-pane fade" id="blended" role="tabpanel">
              <form id="blendedForm">
                <div class="row g-3">
                  <!-- Blended Mortgage Explanation -->
                  <div class="col-12">
                    <div class="alert alert-info">
                      <h6 class="alert-heading mb-2">🏠 Blended Mortgage Calculator</h6>
                      <p class="mb-0">Calculate payments for mortgages with multiple components (e.g., fixed + variable rates, first mortgage + HELOC, or different rate periods).</p>
                    </div>
                  </div>

                  <!-- Property Information -->
                  <div class="col-12">
                    <h6 class="section-title">Property Information</h6>
                  </div>
                  <div class="col-md-6">
                    <label for="blendedHomeValue" class="form-label">Home Value</label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input type="text" class="form-control currency-input" id="blendedHomeValue" placeholder="500,000">
                    </div>
                  </div>

                  <!-- First Mortgage Component -->
                  <div class="col-12 mt-4">
                    <h6 class="section-title">First Mortgage Component</h6>
                  </div>
                  <div class="col-md-4">
                    <label for="firstMortgageAmount" class="form-label">Loan Amount</label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input type="text" class="form-control currency-input" id="firstMortgageAmount" placeholder="320,000">
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="firstMortgageRate" class="form-label">Interest Rate</label>
                    <div class="input-group">
                      <input type="text" class="form-control percentage-input" id="firstMortgageRate" placeholder="6.50">
                      <span class="input-group-text">%</span>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="firstMortgageTerm" class="form-label">Term (Years)</label>
                    <input type="number" class="form-control" id="firstMortgageTerm" value="30" min="5" max="50">
                  </div>

                  <!-- Second Component (HELOC/Line of Credit) -->
                  <div class="col-12 mt-4">
                    <h6 class="section-title">Second Component (HELOC/Line of Credit)</h6>
                  </div>
                  <div class="col-md-4">
                    <label for="secondMortgageAmount" class="form-label">Credit Limit/Amount</label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input type="text" class="form-control currency-input" id="secondMortgageAmount" placeholder="80,000">
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="secondMortgageRate" class="form-label">Interest Rate</label>
                    <div class="input-group">
                      <input type="text" class="form-control percentage-input" id="secondMortgageRate" placeholder="8.25">
                      <span class="input-group-text">%</span>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="secondMortgageType" class="form-label">Type</label>
                    <select class="form-select" id="secondMortgageType">
                      <option value="heloc">HELOC (Interest Only)</option>
                      <option value="fixed">Fixed Term Loan</option>
                      <option value="variable">Variable Rate</option>
                    </select>
                  </div>

                  <!-- Second Component Term (only for fixed loans) -->
                  <div class="col-md-4" id="secondTermContainer" style="display: none;">
                    <label for="secondMortgageTerm" class="form-label">Term (Years)</label>
                    <input type="number" class="form-control" id="secondMortgageTerm" value="15" min="5" max="30">
                  </div>

                  <!-- Additional Component Loans -->
                  <div class="col-12 mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h6 class="section-title mb-0">Additional Component Loans</h6>
                      <button type="button" id="addComponentBtn" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-plus"></i> Add Component
                      </button>
                    </div>
                    <div id="additionalComponents" class="row g-3">
                      <!-- Dynamic components will be added here -->
                    </div>
                  </div>

                  <!-- Additional Costs -->
                  <div class="col-12 mt-4">
                    <h6 class="section-title">Additional Monthly Costs</h6>
                  </div>
                  <div class="col-md-3">
                    <label for="blendedPropertyTax" class="form-label">Property Tax</label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input type="text" class="form-control currency-input" id="blendedPropertyTax" placeholder="500">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <label for="blendedInsurance" class="form-label">Home Insurance</label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input type="text" class="form-control currency-input" id="blendedInsurance" placeholder="150">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <label for="blendedPMI" class="form-label">PMI</label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input type="text" class="form-control currency-input" id="blendedPMI" placeholder="0">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <label for="blendedOther" class="form-label">Other (HOA, etc.)</label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input type="text" class="form-control currency-input" id="blendedOther" placeholder="0">
                    </div>
                  </div>

                  <!-- Calculate Button -->
                  <div class="col-12 text-center mt-4">
                    <button type="button" id="calculateBlendedBtn" class="btn btn-primary btn-lg">💰 Calculate Blended Mortgage</button>
                    <button type="button" id="exportBlendedReportBtn" class="btn btn-success">📄 Export Report</button>
                    <button type="button" id="clearBlendedBtn" class="btn btn-outline-secondary">🔄 Clear Form</button>
                  </div>
                </div>
              </form>
            </div>

            <!-- Purchase Tab (Secondary) -->
            <div class="tab-pane fade" id="purchase" role="tabpanel">
              <form id="mortgageForm">
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="propertyValue">Property Value ($):<span class="required">*</span></label>
                  <input type="text" inputmode="numeric" id="propertyValue" class="form-control" value="0">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="downPaymentAmount">Down Payment ($):<span class="required">*</span></label>
                  <input type="text" inputmode="numeric" id="downPaymentAmount" class="form-control" value="0">
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="downPaymentPercent">Down Payment (%):<span class="required">*</span></label>
                  <input type="text" inputmode="decimal" id="downPaymentPercent" class="form-control" value="0">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="loanTerm">Loan Term (Years):<span class="required">*</span></label>
                  <input type="text" inputmode="numeric" id="loanTerm" class="form-control" value="0">
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="interestRate">Interest Rate (%):<span class="required">*</span></label>
                  <input type="text" inputmode="decimal" id="interestRate" class="form-control" value="0">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="propertyTax">Property Tax (Monthly $):</label>
                  <input type="text" inputmode="numeric" id="propertyTax" class="form-control" value="0">
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="homeInsurance">Home Insurance (Monthly $):</label>
                  <input type="text" inputmode="numeric" id="homeInsurance" class="form-control" value="0">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="hoa">Monthly HOA/Other ($):</label>
                  <input type="text" inputmode="decimal" id="hoa" class="form-control" value="0">
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="pmiRate">PMI Rate (%):</label>
                  <input type="text" inputmode="decimal" id="pmiRate" class="form-control" value="0">
                </div>
                <div class="form-group mt-2">
                  <label for="pmiEndRule">PMI Ends at:</label>
                  <select id="pmiEndRule" class="form-select">
                    <option value="80" selected>80% LTV</option>
                    <option value="78">78% LTV</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="extraPayment">Extra Monthly Payment ($):</label>
                  <input type="text" inputmode="numeric" id="extraPayment" class="form-control" value="0">
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-12 d-flex justify-content-start">
                <button type="button" id="calculateBtn" class="btn btn-primary me-2">Calculate Mortgage</button>
                <button type="button" id="exportReportBtn" class="btn btn-success">Export Report</button>
              </div>
            </div>
          </form>
        </div>

            <!-- HELOC Tab -->
            <div class="tab-pane fade" id="heloc" role="tabpanel">
              <form id="helocForm">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="helocPropertyValue">Estimated Property Value ($):<span class="required">*</span></label>
                      <input type="text" inputmode="numeric" id="helocPropertyValue" class="form-control" value="0">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="helocOutstandingBalance">Outstanding Balance ($):<span class="required">*</span></label>
                      <input type="text" inputmode="numeric" id="helocOutstandingBalance" class="form-control" value="0">
                      <small class="form-text text-muted">All loan balances (mortgage, home equity, etc.)</small>
                    </div>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="helocLoanAmount">HELOC Loan Amount ($):<span class="required">*</span></label>
                      <input type="text" inputmode="numeric" id="helocLoanAmount" class="form-control" value="0">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="helocInterestRate">Interest Rate (%):<span class="required">*</span></label>
                      <input type="text" inputmode="decimal" id="helocInterestRate" class="form-control" value="0">
                    </div>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="helocInterestOnlyPeriod">Interest-Only Period (Years):<span class="required">*</span></label>
                      <input type="text" inputmode="numeric" id="helocInterestOnlyPeriod" class="form-control" value="10">
                      <small class="form-text text-muted">Typically 10-15 years</small>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="helocRepaymentPeriod">Repayment Period (Years):<span class="required">*</span></label>
                      <input type="text" inputmode="numeric" id="helocRepaymentPeriod" class="form-control" value="20">
                      <small class="form-text text-muted">Total loan term including interest-only period</small>
                    </div>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-12 d-flex justify-content-start">
                    <button type="button" id="calculateHelocBtn" class="btn btn-primary me-2">Calculate HELOC</button>
                    <button type="button" id="exportHelocReportBtn" class="btn btn-success">Export Report</button>
                  </div>
                </div>
              </form>
            </div>
        
        </div> <!-- End tab-content -->
        </div> <!-- End card-body -->
        </div>
        </section>
      </div>
      
      <!-- Payment Summary Column -->
      <div class="col-lg-4">
        <!-- Results Summary Section -->
        <section id="resultsSummary" class="results-section mb-2 fade-in-up" style="display: block; margin-top: 0;">
          <div class="card">
            <div class="card-header text-white" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%) !important;">
              <h6 class="mb-0" style="font-size: 0.9rem;">Payment Summary</h6>
            </div>
            <div class="card-body">
              <!-- Two column grid layout for right panel -->
              <div class="row">
                <div class="col-6">
                  <div class="result-item">
                    <h6>Monthly Payment</h6>
                    <p id="monthlyPayment" class="result-value">$0</p>
                  </div>
                </div>
                <div class="col-6">
                  <div class="result-item">
                    <h6>Loan Amount</h6>
                    <p id="loanAmount" class="result-value">$0</p>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <div class="result-item">
                    <h6>Base Monthly Payment (no extra)</h6>
                    <p id="baseMonthlyPayment" class="result-value">$0</p>
                  </div>
                </div>
              </div>
              <div class="row" id="refiCostsInfoRow" style="display: none;">
                <div class="col-12">
                  <div class="result-item">
                    <h6>Closing Costs & Points</h6>
                    <p id="refiCostsInfo" class="result-value">—</p>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                  <div class="result-item">
                    <h6>Total Interest</h6>
                    <p id="totalInterest" class="result-value">$0</p>
                  </div>
                </div>
                <div class="col-6">
                  <div class="result-item">
                    <h6>Principal & Interest</h6>
                    <p id="principalInterest" class="result-value">$0</p>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                  <div class="result-item">
                    <h6>Property Tax</h6>
                    <p id="propertyTaxAmount" class="result-value">$0</p>
                  </div>
                </div>
                <div class="col-6">
                  <div class="result-item">
                    <h6>Home Insurance</h6>
                    <p id="insuranceAmount" class="result-value">$0</p>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-12" id="hoaSummarySection">
                  <div class="result-item">
                    <h6>HOA/Other</h6>
                    <p id="hoaAmount" class="result-value">$0</p>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                  <div class="result-item">
                    <h6>PMI</h6>
                    <p id="pmiAmount" class="result-value">$0</p>
                  </div>
                </div>
                <div class="col-6">
                  <div class="result-item">
                    <h6>Extra Payment</h6>
                    <p id="extraAmount" class="result-value">$0</p>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <div class="result-item">
                    <h6>Total Cost</h6>
                    <p id="totalCost" class="result-value">$0</p>
                  </div>
                </div>
              </div>
        </div>
        </div>
        </section>

        <!-- Blended Mortgage Summary Section -->
        <section id="blendedResultsSummary" class="results-section mb-2 fade-in-up" style="display: block; margin-top: 0;">
          <div class="card">
            <div class="card-header text-white" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%) !important;">
              <h6 class="mb-0" style="font-size: 0.9rem;">Blended Mortgage Analysis</h6>
            </div>
            <div class="card-body">
              <!-- Payment Summary -->
              <div id="summaryData"></div>
            </div>
          </div>
        </section>

        <!-- Comparison Results Section -->
        <section id="comparisonResults" class="comparison-results-section mb-3 fade-in-up">
          <div class="card">
            <div class="card-header text-white" style="background: linear-gradient(135deg, #059669 0%, #10b981 100%) !important;">
              <h6 class="mb-0" style="font-size: 0.9rem;">🏆 Loan Comparison Results</h6>
            </div>
            <div class="card-body">
              <!-- Winner Banner -->
              <div id="comparisonWinner" class="alert alert-success mb-3" style="display: none;">
                <strong>🎯 Best Option: </strong><span id="winnerName"></span>
                <br><small id="winnerReason"></small>
              </div>

              <!-- Comparison Table -->
              <div class="table-responsive">
                <table class="table table-sm comparison-table">
                  <thead>
                    <tr>
                      <th>Metric</th>
                      <th id="loanA_header" class="text-center">Option A</th>
                      <th id="loanB_header" class="text-center">Option B</th>
                      <th id="loanC_header" class="text-center">Option C</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Monthly Payment</strong></td>
                      <td id="compA_monthly" class="text-center">-</td>
                      <td id="compB_monthly" class="text-center">-</td>
                      <td id="compC_monthly" class="text-center">-</td>
                    </tr>
                    <tr>
                      <td><strong>Total Interest</strong></td>
                      <td id="compA_interest" class="text-center">-</td>
                      <td id="compB_interest" class="text-center">-</td>
                      <td id="compC_interest" class="text-center">-</td>
                    </tr>
                    <tr>
                      <td><strong>Total Cost</strong></td>
                      <td id="compA_total" class="text-center">-</td>
                      <td id="compB_total" class="text-center">-</td>
                      <td id="compC_total" class="text-center">-</td>
                    </tr>
                    <tr>
                      <td><strong>Payoff Time</strong></td>
                      <td id="compA_payoff" class="text-center">-</td>
                      <td id="compB_payoff" class="text-center">-</td>
                      <td id="compC_payoff" class="text-center">-</td>
                    </tr>
                    <tr>
                      <td><strong>Closing Costs</strong></td>
                      <td id="compA_fees" class="text-center">-</td>
                      <td id="compB_fees" class="text-center">-</td>
                      <td id="compC_fees" class="text-center">-</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- Savings Analysis -->
              <div id="savingsAnalysis" class="mt-3">
                <div class="row">
                  <div class="col-md-6">
                    <div class="savings-item">
                      <h6>💰 Monthly Savings vs Best Alternative</h6>
                      <p id="monthlySavings" class="savings-value">$0</p>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="savings-item">
                      <h6>🏦 Lifetime Interest Savings</h6>
                      <p id="lifetimeSavings" class="savings-value">$0</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div> <!-- End two-column layout -->

    <!-- Tabs Section -->
    <section class="tabs-section mb-4" id="tabsSection" style="display: none;">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Loan Analysis & Schedule</h5>
          <ul class="nav nav-tabs mt-2" id="mortgageTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary" type="button" role="tab" aria-controls="summary" aria-selected="true">Payment Summary & Analysis</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="chart-tab" data-bs-toggle="tab" data-bs-target="#chart" type="button" role="tab" aria-controls="chart" aria-selected="false">Payment Visualization</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="schedule-tab" data-bs-toggle="tab" data-bs-target="#schedule" type="button" role="tab" aria-controls="schedule" aria-selected="false">Amortization Schedule</button>
            </li>
          </ul>
        </div>
        <div class="card-body">
      <div class="tab-content" id="mortgageTabsContent">
        <!-- Summary Tab -->
        <div class="tab-pane fade show active" id="summary" role="tabpanel" aria-labelledby="summary-tab">
          <div class="card">
            <div class="card-body">
              <h5>Loan Analysis</h5>
              <div class="row">
                <div class="col-md-6">
                  <p><strong>Principal & Interest:</strong> <span id="summaryPI">$0.00</span></p>
                  <p><strong>Taxes & Insurance:</strong> <span id="summaryTI">$0.00</span></p>
                  <p><strong>PMI:</strong> <span id="summaryPMI">$0.00</span></p>
                  <p id="summaryPMIDropRow" style="display: none;"><strong>PMI Ends:</strong> <span id="summaryPMIDrop">—</span></p>
                </div>
                <div class="col-md-6">
                  <p id="summaryHOASection"><strong>HOA/Other:</strong> <span id="summaryHOA">$0.00</span></p>
                  <p><strong>Loan-to-Value Ratio:</strong> <span id="summaryLTV">0%</span></p>
                  <p><strong>Total Interest Paid:</strong> <span id="summaryTotalInterest">$0.00</span></p>
                  <p><strong>Loan Payoff Date:</strong> <span id="summaryPayoffDate">--</span></p>
                  <p id="extraPaymentSavings" style="display: none; color: #28a745; font-weight: bold;"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Chart Tab -->
        <div class="tab-pane fade" id="chart" role="tabpanel" aria-labelledby="chart-tab">
          <div class="card">
            <div class="card-body">
              <h5>Principal vs Interest Over Time</h5>
              <canvas id="amortizationChart" width="400" height="300"></canvas>
              
              <h5 class="mt-4">Loan Balance Over Time</h5>
              <canvas id="balanceChart" width="400" height="300"></canvas>
            </div>
          </div>
        </div>
        
        <!-- Schedule Tab -->
        <div class="tab-pane fade" id="schedule" role="tabpanel" aria-labelledby="schedule-tab">
          <div class="card">
            <div class="card-body">
              <div class="mb-3">
                <button id="exportCsvBtn" class="btn btn-primary me-2">Export to CSV</button>
                <button id="exportPdfBtn" class="btn btn-secondary">Export to PDF</button>
              </div>
              <div class="table-responsive">
                <table class="table table-striped" id="amortizationTable">
                  <thead>
                    <tr>
                      <th>Payment #</th>
                      <th>Payment Date</th>
                      <th>Payment Amount</th>
                      <th>Principal</th>
                      <th>Extra Payment</th>
                      <th>Interest</th>
                      <th>PMI</th>
                      <th>Balance</th>
                    </tr>
                  </thead>
                  <tbody id="scheduleTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        </div> <!-- End card-body -->
      </div> <!-- End card -->
    </section>
  </div>

  <!-- Error Modal -->
  <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="errorModalLabel">Input Error</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="errorModalBody">
          <!-- Error message will be inserted here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Include JavaScript dependencies -->
  <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script src="../node_modules/jspdf/dist/jspdf.umd.min.js"></script>
  <script src="../node_modules/papaparse/papaparse.min.js"></script>
  <!-- Load version configuration -->
  <script src="version.js"></script>
  <!-- Load main application -->
  <script src="mortgage-calculator.js"></script>
  
  <!-- Emergency Tab Fix Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Emergency tab fix script loaded');
      
      // Force tab functionality
      function forceTabSwitch(tabId) {
        console.log('Force switching to tab:', tabId);
        
        // Remove active from all tabs
        document.querySelectorAll('.nav-tabs .nav-link').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // Remove active from all content
        document.querySelectorAll('.tab-content .tab-pane').forEach(pane => {
          pane.classList.remove('active', 'show');
        });
        
        // Activate selected tab and content
        const tabButton = document.getElementById(tabId + '-tab');
        const tabContent = document.getElementById(tabId);
        
        if (tabButton && tabContent) {
          tabButton.classList.add('active');
          tabContent.classList.add('active', 'show');
          console.log('Tab activated:', tabId);
        } else {
          console.error('Tab elements not found:', tabId);
        }
      }
      
      // Attach direct click handlers
      ['refinance', 'comparison', 'blended', 'purchase', 'heloc'].forEach(tabId => {
        const button = document.getElementById(tabId + '-tab');
        if (button) {
          button.onclick = function(e) {
            e.preventDefault();
            console.log('Direct click handler for:', tabId);
            forceTabSwitch(tabId);
          };
          console.log('Direct handler attached to:', tabId);
        }
      });
    });
  </script>

  <!-- Version Management Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Version management script loaded');
      
      // Update version badge with current version
      function updateVersionDisplay() {
        const versionBadge = document.getElementById('versionBadge');
        if (versionBadge && window.AppVersion) {
          const displayVersion = window.AppVersion.VersionUtils.getDisplayVersion();
          versionBadge.innerHTML = `v${displayVersion}`;
          
          // Add click handler for version info
          versionBadge.onclick = function() {
            const versionInfo = window.AppVersion.VersionUtils.getFullVersionInfo();
            const releaseNotes = window.AppVersion.VERSION_INFO.releaseNotes.join('\n• ');
            
            alert(`${versionInfo}\n\nWhat's New:\n• ${releaseNotes}`);
          };
        }
      }
      
      // Initialize version display
      updateVersionDisplay();
      
      console.log('Version system initialized:', window.AppVersion?.APP_VERSION);
    });
  </script>
</body>
</html>